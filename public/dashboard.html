<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Continearn Dashboard - View your balance, referral earnings, and access games">
  <title>Dashboard - Continearn</title>
 <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1280676879896534"
     crossorigin="anonymous"></script>
  <link rel="shortcut icon" href="logo.png" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <!-- Loading Spinner -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
  </div>

  <!-- Privacy Policy Modal (MUST BE BEFORE THE SCRIPT) -->
  <div class="modal-overlay" id="privacyModal" style="z-index: 9999;">
    <div class="modal" style="max-width: 500px; max-height: 80vh; overflow-y: auto;">
      <div class="modal-header">
        <h2>Privacy Policy</h2>
        <p class="text-muted">Please read and accept to continue</p>
      </div>

      <div style="text-align: left; margin-bottom: 20px; font-size: 0.9rem; color: var(--fg-secondary); line-height: 1.6;">
        <p><strong>Welcome to Continearn!</strong></p>
        <p>By using our platform, you agree to the following:</p>
        <ul style="margin-left: 20px; margin-top: 10px;">
          <li><strong>Earnings:</strong> Coins earned in games can be converted to Naira based on our current rates.</li>
          <li><strong>Withdrawals:</strong> Minimum withdrawal is ₦1,000 and is processed at the end of the month.</li>
          <li><strong>Fair Play:</strong> Using bots or cheats will result in a permanent ban.</li>
          <li><strong>Data:</strong> We collect your email, phone, and bank details solely for transactions and verification.</li>
          <li><strong>Ads:</strong> We display advertisements to support the platform rewards.</li>
        </ul>
        <p style="margin-top: 15px;">Your data is safe with us. We do not sell your information to third parties.</p>
      </div>

      <button class="btn btn-primary btn-full btn-lg" id="acceptPrivacyBtn">
        I Accept & Continue
      </button>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard container" id="dashboardContent" style="display: none;">
    <div class="dashboard-header fade-in">
      <p class="user-greeting">Welcome back, <strong id="username">User</strong></p>
    </div>

    <!-- Balance Card -->
    <div class="balance-card fade-in stagger-1">
      <p class="balance-label">Available Balance</p>
      <p class="balance-amount">
        <span class="currency">₦</span><span id="nairaBalance">0.00</span>
      </p>
    </div>

    <div class="balance-row fade-in stagger-2">
      <div class="balance-item">
        <p class="text-muted" style="font-size: 0.85rem;">Coins</p>
        <p style="font-size: 1.5rem; font-weight: 700; color: var(--accent-primary);">
          <i class="fas fa-coins"></i> <span id="coinBalance">0</span>
        </p>
      </div>
      <div class="balance-item">
        <p class="text-muted" style="font-size: 0.85rem;">Referrals</p>
        <p style="font-size: 1.5rem; font-weight: 700; color: var(--accent-primary);">
          <i class="fas fa-users"></i> <span id="totalReferrals">0</span>
        </p>
      </div>
    </div>

    <!-- Referral Card -->
    <div class="referral-card fade-in stagger-3">
      <div class="referral-title">
        <i class="fas fa-link text-accent"></i>
        <span>Referral Link</span>
      </div>
      <div class="referral-link-box">
        <input type="text" class="referral-link-input" id="referralLink" readonly>
        <button class="btn btn-sm btn-primary" onclick="copyReferralLink()">
          <i class="fas fa-copy"></i>
        </button>
      </div>
      <div class="referral-stats">
        <div class="referral-stat">
          <p class="referral-stat-value">100</p>
          <p class="referral-stat-label">Coins/Referral</p>
        </div>
        <div class="referral-stat">
          <p class="referral-stat-value">50</p>
          <p class="referral-stat-label">Bonus for New</p>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-grid fade-in stagger-4">
      <a href="games.html" class="action-btn">
        <div class="action-btn-icon">
          <i class="fas fa-gamepad"></i>
        </div>
        <span class="action-btn-text">Play Games</span>
      </a>
      <a href="withdraw.html" class="action-btn">
        <div class="action-btn-icon">
          <i class="fas fa-wallet"></i>
        </div>
        <span class="action-btn-text">Withdraw</span>
      </a>
    </div>

    <!-- Social Links -->
    <div class="social-section fade-in stagger-4">
      <p class="social-title">Follow us on</p>
      <div class="social-links">
        <a href="https://whatsapp.com/channel/0029VbCiZxa4IBhIV1VYnI23" class="social-link" title="WhatsApp">
          <i class="fab fa-whatsapp"></i>
        </a>
        <a href="t.me/BhIV1VYnI23" class="social-link" title="Telegram">
          <i class="fab fa-telegram"></i>
        </a>
      </div>
    </div>
  <!-- Ad Container -->
    <div class="ad-container container fade-in stagger-1">
              <!-- continearnad -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1280676879896534"
     data-ad-slot="4112142262"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </div>

    <!-- Logout -->
    <div class="text-center mt-4">
      <button class="btn btn-secondary btn-sm" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <!-- Script placed AFTER the HTML elements -->
  <script>
    const token = localStorage.getItem('token');

    if (!token) {
      window.location.href = 'login.html';
    }

    async function loadDashboard() {
      try {
        const response = await fetch('/api/auth/me', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        const data = await response.json();

        if (!data.success) {
          localStorage.removeItem('token');
          window.location.href = 'login.html';
          return;
        }

        const user = data.user;

        // 1. Hide the spinner immediately once data is loaded
        document.getElementById('loadingOverlay').style.display = 'none';

        // 2. Check if user accepted privacy policy
        if (!user.acceptedPrivacy) {
          // Show the modal
          document.getElementById('privacyModal').classList.add('active');
          // Stop here, don't load the dashboard content yet
          return;
        }

        // 3. If accepted, populate dashboard
        populateDashboard(user);

      } catch (error) {
        console.error('Error loading dashboard:', error);
        localStorage.removeItem('token');
        window.location.href = 'login.html';
      }
    }

    function populateDashboard(user) {
      document.getElementById('username').textContent = user.username;
      document.getElementById('coinBalance').textContent = user.coins.toLocaleString();
      document.getElementById('nairaBalance').textContent = user.naira.toFixed(2);
      document.getElementById('totalReferrals').textContent = user.totalReferrals;
      document.getElementById('referralLink').value = user.referralLink;
      document.getElementById('dashboardContent').style.display = 'block';
    }

    function copyReferralLink() {
      const input = document.getElementById('referralLink');
      input.select();
      document.execCommand('copy');
      showToast('Referral link copied!', 'success');
    }

    async function logout() {
      try {
        await fetch('/api/auth/logout', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
      } catch (error) {
        console.error('Logout error:', error);
      }
      localStorage.removeItem('token');
      window.location.href = 'login.html';
    }

    // Handle Accept Button Click
    document.getElementById('acceptPrivacyBtn').addEventListener('click', async () => {
      try {
        const response = await fetch('/api/auth/accept-privacy', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        const data = await response.json();
        if (data.success) {
          document.getElementById('privacyModal').classList.remove('active');
          // Fetch user data again or simply populate from here
          // Let's just run loadDashboard again, it will hide modal and show content
          loadDashboard(); 
        } else {
          showToast('Error accepting policy', 'error');
        }
      } catch (error) {
        showToast('Error', 'error');
      }
    });

    function showToast(message, type) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} toast-icon"></i>
        <span>${message}</span>
      `;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 4000);
    }

    // Initialize
    loadDashboard();
  </script>
</body>

</html>








